### 集合演算(UNION, INTERSECT, EXCEPT)/結合(INER JOIN, OUTER JOIN, CROSS JOIN)/CASE式

- 使うテーブル情報
```
mysql> SELECT * FROM Shohin2;
+-----------+-----------------------+--------------------+--------------+--------------+------------+
| shohin_id | shohin_mei            | shohin_bunrui      | hanbai_tanka | shiire_tanka | torokubi   |
+-----------+-----------------------+--------------------+--------------+--------------+------------+
| 0001      | Tシャツ               | 衣服               |         1000 |          500 | 2009-09-20 |
| 0002      | 穴あけパンチ          | 事務用品           |          500 |          320 | 2009-09-11 |
| 0003      | カッターシャツ        | 衣服               |         4000 |         2800 | NULL       |
| 0009      | 手袋                  | 衣服               |          800 |          500 | NULL       |
| 0010      | やかん                | キッチン用品       |         2000 |         1700 | 2009-09-20 |
+-----------+-----------------------+--------------------+--------------+--------------+------------+
5 rows in set (0.00 sec)

mysql> mysql> SELECT * FROM Shohin;
+-----------+-----------------------+--------------------+--------------+--------------+------------+
| shohin_id | shohin_mei            | shohin_bunrui      | hanbai_tanka | shiire_tanka | torokubi   |
+-----------+-----------------------+--------------------+--------------+--------------+------------+
| 0001      | Tシャツ               | 衣服               |         1000 |          500 | 2009-09-20 |
| 0002      | 穴あけパンチ          | 事務用品           |          500 |          320 | 2009-09-11 |
| 0003      | カッターシャツ        | 衣服               |         4000 |         2800 | NULL       |
| 0004      | 包丁                  | キッチン用品       |         3000 |         2800 | 2009-09-20 |
| 0005      | 圧力鍋                | キッチン用品       |         6800 |         5000 | 2009-01-15 |
| 0006      | フォーク              | キッチン用品       |          500 |         NULL | 2009-09-20 |
| 0007      | おろしがね            | キッチン用品       |          880 |          790 | 2008-04-28 |
| 0008      | ボールペン            | 事務用品           |          100 |         NULL | 2009-11-11 |
+-----------+-----------------------+--------------------+--------------+--------------+------------+
```

#### 集合演算

#### Rules
- UNION(和)
  - レコードの足し算を行う
- 集合演算子は重複行を排除する
- 『ALL』オプションをつけると重複行を排除しない
- 結合するときはFROM句に複数テーブルを記述する
- 

#### KEYWORD
- UNION
  - 和 
- ALL
  - 重複行を削除しない 
- INTERSECT
  - 共通部分 
    - MySQLは未対応 
- EXCEPT
  - 差分
    - MySQLは未対応 
- 結合
  - 内部結合_INNER JOIN 
    - 片方だけのテーブルにある情報は出力しない   
  - 外部結合_OUTER JOIN
    - 片方どちらかのテーブルい存在する情報も出力する
      → マスタのテーブルの情報が全て出力される 
    - 外部結合のポイント
      1. 片方のテーブル情報が全て表示される
      2. どちらのテーブルをマスタにするか(LEFT, RIGHT)
        → マスタ側のテーブル情報は全て出力される
        → LEFT : FROM区の左側がマスタ
        → RIGHT: FROM区の右側がマスタ

#### 集合演算の注意事項
1. 演算対象となるレコードの列数は同じ
  → 片方が2列、もう片方が3列だとエラーになる
2. 足し算の対象となるレコードの列のデータ型が一致していること
  → 型が異なる時の演算はCASTを使って行う
3. SELECT文はどんなものを指定しても良い。ただし,ORDER BY句は最後に1つだけ





- UNIONによるテーブルの足し算
```
mysql> SELECT shohin_id, shohin_mei
    -> FROM Shohin
    -> UNION
    -> SELECT shohin_id, shohin_mei
    -> FROM Shohin2;
+-----------+-----------------------+
| shohin_id | shohin_mei            |
+-----------+-----------------------+
| 0001      | Tシャツ               |
| 0002      | 穴あけパンチ          |
| 0003      | カッターシャツ        |
| 0004      | 包丁                  |
| 0005      | 圧力鍋                |
| 0006      | フォーク              |
| 0007      | おろしがね            |
| 0008      | ボールペン            |
| 0009      | 手袋                  |
| 0010      | やかん                |
+-----------+-----------------------+
```

- ALLオプションを使ってみる(重複行を排除しない)
```
mysql> SELECT shohin_id, shohin_mei
  FROM Shohin 
UNION ALL 
  SELECT shohin_id, shohin_mei 
    FROM Shohin2;

+-----------+-----------------------+
| shohin_id | shohin_mei            |
+-----------+-----------------------+
| 0001      | Tシャツ               |
| 0002      | 穴あけパンチ          |
| 0003      | カッターシャツ        |
| 0004      | 包丁                  |
| 0005      | 圧力鍋                |
| 0006      | フォーク              |
| 0007      | おろしがね            |
| 0008      | ボールペン            |
| 0001      | Tシャツ               |
| 0002      | 穴あけパンチ          |
| 0003      | カッターシャツ        |
| 0009      | 手袋                  |
| 0010      | やかん                |
+-----------+-----------------------+
```
- INNER JOIN( 内部結合)
```
mysql> SELECT TS.tenpo_id, TS.tenpo_mei, TS.shohin_id, S.shohin_mei, S.hanbai_tanka
    -> From TenpoShohin AS TS INNER JOIN Shohin AS S
    -> ON TS.shohin_id = S.shohin_id;
+----------+-----------+-----------+-----------------------+--------------+
| tenpo_id | tenpo_mei | shohin_id | shohin_mei            | hanbai_tanka |
+----------+-----------+-----------+-----------------------+--------------+
| 000A     | 東京      | 0001      | Tシャツ               |         1000 |
| 000A     | 東京      | 0002      | 穴あけパンチ          |          500 |
| 000A     | 東京      | 0003      | カッターシャツ        |         4000 |
| 000B     | 名古屋    | 0002      | 穴あけパンチ          |          500 |
| 000B     | 名古屋    | 0003      | カッターシャツ        |         4000 |
| 000B     | 名古屋    | 0004      | 包丁                  |         3000 |
| 000B     | 名古屋    | 0006      | フォーク              |          500 |
| 000B     | 名古屋    | 0007      | おろしがね            |          880 |
| 000C     | 大阪      | 0003      | カッターシャツ        |         4000 |
| 000C     | 大阪      | 0004      | 包丁                  |         3000 |
| 000C     | 大阪      | 0006      | フォーク              |          500 |
| 000C     | 大阪      | 0007      | おろしがね            |          880 |
| 000D     | 福岡      | 0001      | Tシャツ               |         1000 |
+----------+-----------+-----------+-----------------------+--------------+
```

- INNER JOINにWHERE句も使ってみる
```
mysql> SELECT TS.tenpo_id, TS.tenpo_mei, TS.shohin_id, S.shohin_mei, S.hanbai_tanka
    -> FROM TenpoShohin AS TS INNER JOIN Shohin AS S
    -> ON TS.shohin_id = S.shohin_id
    -> WHERE TS.tenpo_id = '000A';
+----------+-----------+-----------+-----------------------+--------------+
| tenpo_id | tenpo_mei | shohin_id | shohin_mei            | hanbai_tanka |
+----------+-----------+-----------+-----------------------+--------------+
| 000A     | 東京      | 0001      | Tシャツ               |         1000 |
| 000A     | 東京      | 0002      | 穴あけパンチ          |          500 |
| 000A     | 東京      | 0003      | カッターシャツ        |         4000 |
+----------+-----------+-----------+-----------------------+--------------+
```

- OUTER JOIN(RIGHT)を使ってみる
```
mysql> SELECT TS.tenpo_id, TS.tenpo_mei, TS.shohin_id, S.shohin_mei, S.hanbai_tanka FROM TenpoShohin AS TS RIGHT OUTER JOIN Shohin AS S ON TS.shohin_id = S.shohin_id;
+----------+-----------+-----------+-----------------------+--------------+
| tenpo_id | tenpo_mei | shohin_id | shohin_mei            | hanbai_tanka |
+----------+-----------+-----------+-----------------------+--------------+
| 000A     | 東京      | 0001      | Tシャツ               |         1000 |
| 000A     | 東京      | 0002      | 穴あけパンチ          |          500 |
| 000A     | 東京      | 0003      | カッターシャツ        |         4000 |
| 000B     | 名古屋    | 0002      | 穴あけパンチ          |          500 |
| 000B     | 名古屋    | 0003      | カッターシャツ        |         4000 |
| 000B     | 名古屋    | 0004      | 包丁                  |         3000 |
| 000B     | 名古屋    | 0006      | フォーク              |          500 |
| 000B     | 名古屋    | 0007      | おろしがね            |          880 |
| 000C     | 大阪      | 0003      | カッターシャツ        |         4000 |
| 000C     | 大阪      | 0004      | 包丁                  |         3000 |
| 000C     | 大阪      | 0006      | フォーク              |          500 |
| 000C     | 大阪      | 0007      | おろしがね            |          880 |
| 000D     | 福岡      | 0001      | Tシャツ               |         1000 |
| NULL     | NULL      | NULL      | 圧力鍋                |         6800 |
| NULL     | NULL      | NULL      | ボールペン            |          100 |
+----------+-----------+-----------+-----------------------+--------------+
```
